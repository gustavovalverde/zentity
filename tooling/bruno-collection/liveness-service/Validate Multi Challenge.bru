meta {
  name: Validate Multi Challenge
  type: http
  seq: 6
}

post {
  url: {{liveness_base_url}}/challenge/validate-multi
  body: json
  auth: none
}

headers {
  Content-Type: application/json
}

body:json {
  {
    "baselineImage": "{{baseline_image_base64}}",
    "challengeResults": [
      {
        "challenge_type": "smile",
        "image": "{{smile_image_base64}}"
      },
      {
        "challenge_type": "turn_left",
        "image": "{{turn_left_image_base64}}"
      }
    ]
  }
}

docs {
  # Validate Multiple Challenges (Batch)

  Validate multiple challenges at once as an alternative to session-based flow.
  The frontend collects all challenge images and sends them together.

  ## Request Body

  | Field | Type | Required | Description |
  |-------|------|----------|-------------|
  | baselineImage | string | Yes | Base64 baseline (neutral face) |
  | challengeResults | array | Yes | Array of challenge results |

  ## Challenge Result Object

  ```json
  {
    "challenge_type": "smile",
    "image": "base64..."
  }
  ```

  ## Response

  ```json
  {
    "allPassed": true,
    "totalChallenges": 2,
    "passedCount": 2,
    "results": [
      {
        "index": 0,
        "challengeType": "smile",
        "passed": true,
        "score": 75.5
      },
      {
        "index": 1,
        "challengeType": "turn_left",
        "passed": true,
        "score": -0.28
      }
    ],
    "processingTimeMs": 320
  }
  ```

  ## Privacy

  All images processed transiently and never stored.
}

assert {
  res.status: eq 200
  res.body.allPassed: isDefined
  res.body.results: isDefined
}
