# yaml-language-server: $schema=https://railway.com/railway.schema.json
# Web Service - Next.js on port 8080
# Public domain: app.zentity.xyz
#
# Required env vars (set via Railway dashboard/CLI):
#   NODE_ENV=production
#   BETTER_AUTH_SECRET=<secret>
#   BETTER_AUTH_URL=https://app.zentity.xyz
#   NEXT_PUBLIC_APP_URL=https://app.zentity.xyz
#   INTERNAL_SERVICE_TOKEN=<secret>
#   DATABASE_PATH=/var/lib/zentity/web/dev.db
#   BB_CRS_PATH=/var/lib/zentity/bb-crs
#   FHE_SERVICE_URL=http://fhe.railway.internal:5001
#   OCR_SERVICE_URL=http://ocr.railway.internal:5004
#
# Required volumes (create via Railway dashboard):
#   web-volume â†’ /var/lib/zentity
#     - Persists SQLite database at /var/lib/zentity/web/dev.db
#     - Persists BB CRS cache at /var/lib/zentity/bb-crs
#
# Schema apply (run after volume is mounted):
#   DATABASE_PATH=$RAILWAY_VOLUME_MOUNT_PATH/web/dev.db bun run db:push

[build]
builder = "DOCKERFILE"

[build.args]
NEXT_PUBLIC_APP_URL = "https://app.zentity.xyz"

[deploy]
healthcheckPath = "/api/health"
healthcheckTimeout = 300
restartPolicyType = "ALWAYS"
numReplicas = 1
